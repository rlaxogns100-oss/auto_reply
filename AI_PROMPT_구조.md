# 에이전트에게 전달되는 정보 상세 구조

## 1. Query Agent (쿼리 생성 단계)

### 전달 순서
1. 커스텀 프롬프트 (사용자 정의)
2. 부적절한 글 예시 (10개)
3. 게시글 정보
4. 생성 요청 지침

### 실제 프롬프트 구조

```
{사용자가 설정한 Query Agent 프롬프트}

==================================================
[❌ 답변하면 안 되는 부적절한 글 예시]
아래와 같은 글에는 PASS 처리하세요. (빈 배열 반환)
==================================================

[부적절한 글 1]
원글: 오늘 공부 ㅈㄴ 잘했다 ㅋㅋㅋ 10시간 공부함

[부적절한 글 2]
원글: 서울대 vs 연대 어디가 나아요?

... (총 10개)

[게시글]
제목: 홍익대 미술대학 수시 질문
본문: 안녕하세요, 고3입니다. 내신 3.2인데 홍익대 미술대학 수시로 지원하려고 하는데 가능할까요? (최대 1000자)

위 게시글을 분석하여 function_calls를 JSON 형식으로 생성하세요.
```

### 설정
- **Temperature**: 0.0 (정확성 최우선)
- **Max Tokens**: 2048
- **Output Format**: JSON

### 응답 예시
```json
{
  "function_calls": [
    {
      "function": "search_admission_data",
      "params": {
        "university": "홍익대학교",
        "query": "미술대학 수시 내신 3.2 합격선"
      }
    }
  ]
}
```

또는 PASS 처리 시:
```json
{
  "function_calls": []
}
```

---

## 2. RAG (검색 단계)

Query Agent가 생성한 function_calls를 Backend API로 전송하여 입시 데이터 검색

### API 요청
```json
POST /api/functions/execute
{
  "function_calls": [
    {
      "function": "search_admission_data",
      "params": {
        "university": "홍익대학교",
        "query": "미술대학 수시 내신 3.2 합격선"
      }
    }
  ]
}
```

### API 응답 (RAG 검색 결과)
```json
{
  "success": true,
  "results": {
    "홍익대학교_search_admission_data": {
      "university": "홍익대학교",
      "chunks": [
        {
          "content": "홍익대 미술대학 2025학년도 수시 학생부교과전형 70% 컷은 3.15등급입니다. 모집인원 120명에 최초합 3.08, 추합 50번까지 3.45등급 선에서 형성되었습니다.",
          "score": 0.92
        },
        {
          "content": "홍익대 미술대학은 실기 60% + 학생부 40% 반영으로 내신이 다소 낮아도 실기 점수로 충분히 만회 가능합니다.",
          "score": 0.88
        }
      ]
    }
  }
}
```

### 포맷팅 후 (Answer Agent에게 전달될 형태)
```
=== 관련 입시 정보 (홍익대학교) ===
[1] 홍익대 미술대학 2025학년도 수시 학생부교과전형 70% 컷은 3.15등급입니다. 모집인원 120명에 최초합 3.08, 추합 50번까지 3.45등급 선에서 형성되었습니다.
[2] 홍익대 미술대학은 실기 60% + 학생부 40% 반영으로 내신이 다소 낮아도 실기 점수로 충분히 만회 가능합니다.
```

---

## 3. Answer Agent (최종 답변 생성 단계)

### 전달 순서
1. 사용자 정의 프롬프트 (작성 지침)
2. 학습 예시 (좋은 예시 10개 + 나쁜 예시 10개)
3. 게시글 정보
4. RAG 검색 결과

### 실제 프롬프트 구조

```
[✍️ 작성 지침 및 역할]
{사용자가 설정한 Answer Agent 프롬프트}

==================================================
[✅ 따라해야 할 좋은 예시]
==================================================
아래는 승인된 댓글 예시입니다. 이런 스타일로 작성하세요.

특징:
- 핵심만 간결하게 (3-5문장)
- 구체적 수치와 데이터 활용
- "~입니다", "~하세요" 등 존댓말
- 불필요한 장황한 설명 제거
- 200자 이내로 간결하게

[좋은 예시 1]
원글: 경희대 정시 표점 380점이면 어디 가능할까요?
답변: 경희대 정시 일반전형 기준 작년 인문계는 380점대에서 국제학부(370), 사회학과(375) 정도가 안정권입니다. 자연계는 생명과학(378), 환경공학(372) 선에서 형성되었으니 계열에 맞춰 지원하시면 됩니다.

[좋은 예시 2]
원글: 성균관대 경영 최저 2합 5인데 어려운가요?
답변: 성균관대 경영학과 최저는 2개 합 5이지만 경쟁률이 5:1 이상으로 높아 실제로는 2합 4 정도는 맞춰야 안정적입니다. 작년 70% 컷이 내신 1.8등급이었으니 내신과 최저 모두 철저히 준비하세요.

... (총 10개)

==================================================
[❌ 따라하면 안 되는 나쁜 예시]
==================================================
아래와 같은 답변은 피하세요.

문제점:
- 너무 길고 장황함 (300자 이상)
- 추상적이고 일반론적 조언만 나열
- 구체적 데이터 없이 "노력하세요" 같은 무의미한 격려
- 원글과 무관한 내용

[나쁜 예시 1]
원글: 연대 경영 vs 고대 경영 어디가 나을까요?
답변: 두 학교 모두 훌륭한 선택입니다. 연세대는 캠퍼스가 넓고 국제교류가 활발하며, 고려대는 전통이 깊고 동문 네트워크가 탄탄합니다. 어느 학교를 선택하든 본인이 얼마나 열심히 하느냐가 중요합니다. 대학 생활을 즐기면서도 학점 관리를 잘 하시고, 인턴십이나 공모전 같은 대외활동도 적극적으로 참여하세요. 취업은 결국 개인의 역량이 가장 중요하니 너무 학교 간판만 보지 마시고...

[나쁜 예시 2]
원글: 서강대 경제 정시로 가능할까요? 표점 350점입니다.
답변: 정시는 매년 입결이 변동되기 때문에 정확히 예측하기 어렵습니다. 본인의 성적을 진학사나 유웨이 같은 입시 기관에서 분석해보시고, 여러 학교를 비교해보세요. 안정, 적정, 상향 지원을 골고루 섞어서 전략을 짜는 것이 중요합니다.

... (총 10개)

[📋 게시글 정보]
제목: 홍익대 미술대학 수시 질문
본문: 안녕하세요, 고3입니다. 내신 3.2인데 홍익대 미술대학 수시로 지원하려고 하는데 가능할까요? (최대 1000자)

[📚 관련 입시 정보 (RAG)]
아래는 게시글과 관련된 공식 입시 정보입니다. 답변 시 참고하세요.

=== 관련 입시 정보 (홍익대학교) ===
[1] 홍익대 미술대학 2025학년도 수시 학생부교과전형 70% 컷은 3.15등급입니다. 모집인원 120명에 최초합 3.08, 추합 50번까지 3.45등급 선에서 형성되었습니다.
[2] 홍익대 미술대학은 실기 60% + 학생부 40% 반영으로 내신이 다소 낮아도 실기 점수로 충분히 만회 가능합니다.

⚠️ 중요: 기존 댓글에 이미 우리 봇(uni2road, 입시 ai, 하늘담아, 도군)의 댓글이 있다면 빈 문자열만 반환하세요.
```

### 설정
- **Temperature**: 0.3 (약간의 창의성 허용)
- **Max Tokens**: 2048
- **Output Format**: Text

### 응답 예시
```
내신 3.2면 홍익대 미술대학 학생부교과전형 70% 컷(3.15)보다 약간 낮지만 충분히 도전 가능합니다. 실기전형은 실기 60% + 학생부 40% 반영이라 내신이 다소 낮아도 실기로 만회할 수 있으니 실기 준비에 집중하세요.
```

### 최종 포맷팅 (랜덤 오프닝/클로징 추가)
```
수험생 전문 ai에 물어보니까 이러네요

내신 3.2면 홍익대 미술대학 학생부교과전형 70% 컷(3.15)보다 약간 낮지만 충분히 도전 가능합니다. 실기전형은 실기 60% + 학생부 40% 반영이라 내신이 다소 낮아도 실기로 만회할 수 있으니 실기 준비에 집중하세요.

구글에 uni2road 검색해서 써 보세요
```

---

## 요약

### Query Agent
- **입력**: 커스텀 프롬프트 + 부적절한 글 10개 + 게시글
- **출력**: JSON (function_calls 배열)
- **목적**: 어떤 정보를 검색할지 결정

### RAG (검색)
- **입력**: function_calls
- **출력**: 입시 데이터 청크 (최대 10개)
- **목적**: 신뢰할 수 있는 입시 정보 제공

### Answer Agent
- **입력**: 사용자 정의 프롬프트 + 좋은 예시 10개 + 나쁜 예시 10개 + 게시글 + RAG 결과
- **출력**: 최종 답변 텍스트
- **목적**: 간결하고 정확한 댓글 생성
